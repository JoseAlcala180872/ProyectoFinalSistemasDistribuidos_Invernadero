<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Alarmas</title>
  <link rel="stylesheet" href="/asstets/css/alarmas.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-icon active"><i class="fas fa-home"></i></div>
    <div class="sidebar-icon"><i class="fas fa-plus"></i></div>
    <div class="sidebar-icon"><i class="fas fa-bell"></i></div>
    <div class="sidebar-icon"><i class="fas fa-chart-line"></i></div>
    <div class="sidebar-icon"><i class="fas fa-cog"></i></div>
  </div>

  <div class="main-content">
    <header class="header">
      <h1>Alarmas</h1>
      <div class="search-bar">
        <input type="text" placeholder="Buscar alerta...">
        <i class="fas fa-search"></i>
      </div>
      <div class="header-icons">
        <i class="fas fa-bell"></i>
        <i class="fas fa-plus-circle"></i>
        <i class="fas fa-trash"></i>
      </div>
    </header>

    <section class="alert-list" id="alertList">
      <!-- Las alarmas se llenarán aquí dinámicamente -->
    </section>
  </div>
  <script type="module">
    import { obtenerAlarmas } from './servicios/alarmaServicio.js';

    function iconoPorParametro(parametro) {
      return parametro === 'temperatura' ? 'fa-temperature-high' : 'fa-tint';
    }

    function textoPorTipo(tipo, parametro) {
      if (tipo === 'alta') return `Subió la ${parametro}`;
      if (tipo === 'baja') return `Bajó la ${parametro}`;
      return `Alarma de ${parametro}`;
    }

    async function mostrarAlarmas() {
      const contenedor = document.getElementById('alertList');
      contenedor.innerHTML = '';
      try {
        const alarmas = await obtenerAlarmas();
        if (alarmas.length === 0) {
          contenedor.innerHTML = '<div>No hay alarmas activas.</div>';
          return;
        }
        alarmas.forEach(a => {
          const div = document.createElement('div');
          div.className = 'alert';
          div.innerHTML = `
            <div class="icon"><i class="fas ${iconoPorParametro(a.parametro)}"></i></div>
            <div class="text">
              <strong>${a.tipo.charAt(0).toUpperCase() + a.tipo.slice(1)} (${a.parametro})</strong>
              <p>${textoPorTipo(a.tipo, a.parametro)} (umbral: ${a.umbral})</p>
            </div>
            <div class="power"><i class="fas fa-power-off"></i></div>
          `;
          contenedor.appendChild(div);
        });
      } catch (e) {
        contenedor.innerHTML = '<div>Error al cargar alarmas</div>';
      }
    }

    mostrarAlarmas();
  </script>
</body>
</html>
